/*! */
W.tag("annotation",'<div data-ref="content"></div>',"#plugin-annotation{background-color:rgba(68,65,65,0.84);position:absolute;left:8px;width:300px;top:80px;border-radius:10px;padding:5px}#plugin-annotation .closing-x{display:block}#plugin-annotation .avatar{float:left;margin-right:10px}#plugin-annotation .closing-x{font-size:28px;margin-top:-15px;right:-20px}","",function(n){var i=this,t=W.require,e=t("annotation"),r=t("location");this.onopen=function(a){e.saveCurrentScreen(),e.load(a).then(function(n){var t=n.username,e=n.avatar,o=n.name;i.refs.content.innerHTML='\n\t\t\t<img src="'+e+'" class="avatar size-s">\n\t\t\tUser @'+t+" shared an annotation with you <b>"+o+"</b>",r.url("/annotation/"+a)})},this.onclose=function(){e.remove(),e.restoreScreen()}}),
/*! */
W.define("annotation",["rootScope","utils","store","map","http"],function(n,t,c,u,o){var e,a,s=["product","acTime","level","overlay","pois","path","isolines","timestamp"],l=null,i={},r=!1,f=!1,p=function(n){return new Promise(function(e,t){o.get("https://node-s.windy.com/imaker/annotations/"+n).then(function(n){var t=n.data;l=d(t),e(t)}).catch(function(n){t(n)})})},m=function(){clearTimeout(a),f=!0,e&&r&&(u.center(e),s.forEach(function(n){return c.set(n,i[n])}),r=!1)},d=function(n){var t=n.image,e=n.imageBounds,o=n.mapBounds,a=n.params,i=function(n){var t=n.north,e=n.south,o=n.east;return[[e,n.west],[t,o]]};a.timestamp&&+a.timestamp<Date.now()&&(a.timestamp=Date.now()),s.forEach(function(n){return c.set(n,a[n])}),u.fitBounds(i(o)),l&&u.removeLayer(l);var r=L.imageOverlay(t,i(e));return r.addTo(u),r},v=function(){clearTimeout(a),l&&u.removeLayer(l)};return{saveCurrentScreen:function(){r||(e=t.clone(n.map),s.forEach(function(n){i[n]=c.get(n)}),r=!0)},loadPresentation:function(n){var t=0;if(1!==n.length){clearTimeout(a),f=!1;var e=function(){p(n[t]).then(function(){f||(++t>=n.length&&(t=0),a=setTimeout(e,4e3))})};e()}else p(n[0])},load:p,remove:v,restoreScreen:m,close:function(){v(),m()}}});