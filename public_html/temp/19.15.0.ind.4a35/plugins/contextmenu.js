/*! */
W.tag("contextmenu",'<div class="context-coords" data-do="copy" data-tooltipsrc="COPY_TO_C"></div><nav class="menu-items" data-ref="menu"><a data-do="picker" class="clickable-size" data-t="SHOW_PICKER" data-icon="&#xe034;"></a><a data-do="detail" class="clickable-size" data-t="D_FCST" data-icon="&"></a><a data-do="distance" class="clickable-size" data-t="MENU_DISTANCE" data-icon=","></a><a data-do="sounding" class="clickable-size" data-t="SOUNDING" data-icon="&#xe015;"></a></nav>',"#plugin-contextmenu{font-size:12px;padding:.5em .7em;line-height:2;z-index:100}#plugin-contextmenu .closing-x{display:none}#plugin-contextmenu .context-coords{color:#9D0300;margin-bottom:.3em}#device-mobile #plugin-contextmenu{font-size:18px;position:fixed;left:20px;top:20px;right:20px}#device-mobile #plugin-contextmenu::before,#device-mobile #plugin-contextmenu::after{display:none}","",function(e){var o,i,c,l=this,t=W.require,n=t("broadcast"),s=t("$"),d=t("rootScope"),r=t("format"),p=t("map"),a=t("ClickHandler"),u=t("plugins"),m=t("utils");a.instance({el:this.node,stopPropagation:!0,click:function(e){switch(e){case"distance":n.emit("rqstOpen","distance",o);break;case"copy":m.copy2clipboard(c);break;default:/^windy-plugin|detail|sounding|picker/.test(e)&&n.emit("rqstOpen",e,{lat:o.lat,lon:o.lng,source:"contextmenu"})}"copy"!==e&&n.emit("rqstClose","contextmenu")}});var x=function(e){var t=u[e];t&&"hook"in t&&"contextmenu"===t.hook&&(l.refs.menu.insertAdjacentHTML("beforeend",'<a data-do="'+t.ident+'" data-icon="&#xe03e;">'+t.title+"</a>"),t.hook=null)};Object.keys(u).forEach(x),n.on("externalPluginLoaded",x),this.onopen=function(e){var t=e.latlng,n=e.containerPoint;o=t instanceof L.LatLng?t.wrap():t;var a=r.DD2DMS(o.lat,o.lng);c=m.normalizeLatLon(o.lat)+", "+m.normalizeLatLon(o.lng),s(".context-coords",l.node).innerHTML=a,!d.isMobile&&n&&(l.node.style.left=n.x-25+"px",l.node.style.top=n.y+10+"px"),i?i.setLatLng(o):i=L.marker(o,{icon:p.myMarkers.pulsatingIcon,zIndexOffset:-300}).addTo(p)},this.onclose=function(){i&&(p.removeLayer(i),i=null)}});