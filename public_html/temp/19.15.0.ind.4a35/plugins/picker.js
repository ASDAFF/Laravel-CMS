/*! */
W.define("Picker",["metrics","store","format","picker","$","utils","broadcast","trans","overlays","rootScope","interpolator","Class","ClickHandler"],function(p,l,r,n,a,d,s,h,k,u,c,e,g){return e.extend(n,{interpolate:null,popup:null,padding:{left:60,right:60,top:60,bottom:100},lastRender:0,el:a("#plugin-picker"),close:function(){u.picker=null,this.popup&&(document.body.classList.remove("moooving"),this.hasHooks&&(s.off("redrawFinished",this.updateInterFun,this),s.off("metricChanged",this.update,this),this.hasHooks=!1),this.removePicker(),this.popup=null,this.emit("pickerClosed"))},clickOnMap:function(e){var t=e.x,i=e.y,o=e.lat,r=e.lon;i<this.padding.top||i>u.map.height-this.padding.bottom||t<this.padding.left||t>u.map.width-this.padding.right||(this.clickedX=t,this.clickedY=i,this.open(o,r,!1,"click"))},open:function(e,t,i,o){this.popup?this.move(e,t,i,o):(this.formatDir=r.getDirFunction(),this.show(e,t,i,o)),n.getParams=this.getParams.bind(this)},show:function(e,t,i,o){var r=this;this.lat=e,this.lon=t,this.getInterpolator(function(){r.mountPicker(e,t,o),r.hasHooks||(s.on("redrawFinished",r.updateInterFun,r),s.on("metricChanged",r.update,r),r.hasHooks=!0),r.update(),i||r.emit("pickerOpened",{lat:e,lon:t,source:"picker"})})},mountPicker:function(e,t,i){var o=this;this.popup=this.createPicker(e,t,i),this.popupContent=a(".picker-content",this.popup),g.instance({el:this.popup,stopPropagation:!0,click:function(e){switch(e){case"openDetailMobile":if(!u.isMobile)return;case"openDetail":s.emit.call(s,"rqstOpen","detail",o.getParams())}}})},getInterpolator:function(o){var r=this;c(function(e,t,i){r.isAsync=i,r.interpolate=e.bind(c),r.interpolateXY=t.bind(c),o.call(r)})},updateInterFun:function(){this.getInterpolator(this.update)},updateAsync:function(){var t=this,e=this.getLatLng(),i={lat:e.lat,lon:e.lng};u.picker=i,this.interpolate(i).then(function(e){return t.render(e,i)})},update:function(e){if(this.isAsync&&!e)this.updateAsync();else{var t=Date.now();if(!this.popup||t-this.lastRender<300)return;this.lastRender=t;var i=this.getLatLng(),o={lat:i.lat,lon:i.lng},r=this.interpolate(o);u.picker=o,null==r?s.emit("rqstClose","picker"):this.render(r,o)}},render:function(e,t){Array.isArray(e)||e<0?(this.popupContent.classList.remove("p-empty"),this.popupContent.firstChild.innerHTML=this.createHTML(e,t)):(this.popupContent.classList.add("p-empty"),this.popupContent.firstChild.innerHTML="")},dragend:function(){this.popup&&(document.body.classList.remove("moooving"),this.update(),this.emit("pickerMoved",this.getParams(),{overlay:this.latestOverlay,values:this.latestValues}))},createHTML:function(e,t){var i,o,r='<div class="p-title">',n=l.get("overlay"),a=Array.isArray(e)&&e[0],s=k[n],c=s.getName();switch(this.latestValues=e,this.latestOverlay=n){case"wind":case"currents":i=d.wind2obj(e),r+=" "+c+'</div><big><i title="Direction from, true north">'+d.windDir2html(i)+this.formatDir(i.dir)+"</i> "+s.convertValue(i.wind)+"</big>";break;case"waves":case"swell1":case"swell2":case"swell3":case"wwaves":r+=c+'</div><big><i title="Direction from, true north" data-dir="'+(i=d.wave2obj(e)).dir+'">'+this.formatDir(i.dir)+"</i> "+s.convertValue(i.size)+"</big>"+h.PERIOD+" "+Math.round(i.period)+" s.<br>";break;case"snowcover":r+=c+"</div><big>"+(490<a?"More than 5m":s.convertValue(a))+"</big>"+(.5<a?h.SNOWDENSITY+" "+Math.round(e[1])+" kg/m3<br>":"");break;case"cape":r+=h.THUNDER+" (CAPE Index)</div><big>"+s.convertValue(a)+"</big>";break;case"cbase":r+=a<1e4?h.CLOUD_ALT+"</div><big>"+s.convertValue(a)+"</big>":"</div>";break;case"ptype":case"rain":o=e[1],c=p.ptype.convertNumber(o)||h.RAIN,r+=0<o?c+" (3h)":"",r+="</div><big>"+k[/5|6/.test(o)?"snowAccu":"rain"].convertValue(a)+"</big>";break;case"clouds":case"lclouds":case"hclouds":case"mclouds":r+=c+"</div><big>"+Math.floor(a)+"%</big>"+(.3<e[1]?k.rain.convertValue(e[1])+"<br>":"");break;case"capAlerts":case"fog":r+=c+"</div><big>"+h.D_FCST+"</big>";break;case"radar":r+=c+"</div><big>"+(u.isMobile?"Max: "+e[1]+"dBZ</big>":"Latest: "+e[0]+"dBZ</big>Max: "+e[1]+"dBZ<br>");break;case"map":r+="Elevation</div><big>"+p.elevation.convertValue(a)+"</big>";break;default:r+=c+"</div><big>"+s.convertValue(a)+"</big>"}return this.displayLanLon&&t&&(r+=this.createCoordsHtml(t)),r}})}),
/*! */
W.define("pickerDesktop",["format","$","broadcast","map","trans","store","Picker","utils"],function(r,o,n,a,s,c,e,t){return e.instance({wasDragged:c.get("wasDragged"),displayLanLon:!1,_init:function(){this.html=this.el.innerHTML,this.el.innerHTML=""},removePicker:function(){this.wasDragged=!0,n.off(this.mapDragHandler),a.removeLayer(this.marker)},getLatLng:function(){return this.marker.getLatLng().wrap()},getParams:function(){var e=this.getLatLng();return{lat:e.lat,lon:e.lng,source:"picker",values:this.latestValues,overlay:this.latestOverlay}},move:function(e,t,i){this.marker.setLatLng([e,t]),this.update(),i||this.emit("pickerMoved",{source:"picker",lat:e,lon:t})},checkAndRemove:function(e){var t=this.getLatLng(),i=t.lat,o=t.lng;(o<e.west||o>e.east||i>e.north||i<e.south)&&n.emit("rqstClose","picker")},createPicker:function(e,t){this.displayLanLon=c.get("latlon");var i=L.divIcon({className:"picker open",html:this.html+(this.wasDragged?"":'<div class="picker-drag-me">'+s.DRAG_ME+"</div>"),iconSize:[0,125],zIndexOffset:800,iconAnchor:[0,125]});return this.marker=L.marker([e,t],{icon:i,draggable:!0}).on("dragstart",this.dragstart,this).on("drag",this.update.bind(this,!0),this).on("dragend",this.dragend,this).addTo(a),this.displayLanLon&&(o(".picker-content",this.marker._icon).onmousedown=this.copyToClipboard.bind(this),o(".picker-share",this.marker._icon).style.display="none"),this.mapDragHandler=n.on("mapChanged",this.checkAndRemove,this),this.marker._icon},dragstart:function(){this.wasDragged||(o(".picker-drag-me",this.popup).style.opacity=0,o(".picker-drag-me",this.popup).style.visibility="hidden",this.wasDragged=!0,c.set("wasDragged",!0)),document.body.classList.add("moooving")},createCoordsHtml:function(e){var t=e.lat,i=e.lon,o=r.DD2DMS(t,i);return'<a class="picker-latlon" id="coords-to-clipboard" data-tooltip="'+s.COPY_TO_C+'">'+o+"</a>"},copyToClipboard:function(){t.copy2clipboard(t.normalizeLatLon(this.lat)+", "+t.normalizeLatLon(this.lon))}})}),
/*! */
W.define("pickerMobile",["map","Picker"],function(s,e){return e.instance({removePicker:function(){s.removeZoomCenter(),this.dragHook&&(s.off("drag",this.ondrag,this),s.off("dragend",this.dragend,this),this.dragHook=!1)},_init:function(){this.move=this.show},ondrag:function(){var e=Date.now();if(!(this.isAsync||e-this.lastRender<100)){this.lastRender=e;var t=s._getTopLeftPoint(),i=this.x+t.x,o=this.y+t.y,r=this.interpolateXY(i-this.layerX,o-this.layerY,i,o);null!=r&&this.render(r)}},updateInterFun:function(){this.updateLayerXY(),e.updateInterFun.call(this)},updateLayerXY:function(){var e=s._getTopLeftPoint();this.layerX=e.x,this.layerY=e.y},getLatLng:function(){return s.containerPointToLatLng([this.x,this.y])},getParams:function(){var e=this.getLatLng();return{lat:e.lat,lon:e.lng,source:"picker"}},createPicker:function(e,t,i){if(this.popup||(this.x=this.el.offsetLeft+1,this.y=this.el.offsetTop+this.el.offsetHeight,s.setZoomCenter(this.x,this.y)),"click"!==i){var o=s.getZoom(),r=s.getSize().y,n=s.project([e,t],o).subtract([0,this.y-r/2]),a=s.unproject(n,o);s.setView(a,o,{animate:!0})}return this.updateLayerXY(),this.dragHook||(this.dragHook=!0,s.on("drag",this.ondrag,this),s.on("dragend",this.dragend,this)),this.el}})}),
/*! */
W.tag("picker",'<div class="picker-lines noselect"></div><div class="picker-content noselect"><span data-do="openDetailMobile"></span><a class="picker-link iconfont tooltip-right shy" data-do="openDetail" data-tooltipsrc="D_FCST">?</a><a class="picker-share mobilehide shy" data-do="share" data-icon="F" data-t="SHARE_FCST"></a><a class="picker-close-button shy" data-do="rqstClose,picker" data-icon="&#xe013;"></a></div>',".picker .picker-drag-me:before{font-family:iconfont;font-variant:normal;text-transform:none;line-height:1}.picker{transition:.3s opacity 0s;-webkit-transition:.3s opacity 0s;font-size:11px;letter-spacing:1px;animation:fadein-full 1s;-webkit-animation:fadein-full 1s;opacity:0}.picker:focus{outline:none}#device-mobile .picker{-webkit-transition:none;transition:none;position:fixed;left:50%;top:180px;margin-top:-70px}#device-mobile .has-statusbar .picker{top:200px}#device-mobile .onsearch .picker,#device-mobile .onweather .picker,#device-mobile .onfavs .picker,#device-mobile .onmenu .picker{visibility:hidden}.picker.open{opacity:1}.onsearch .picker{opacity:0}.picker .closing-x{display:none}.picker .picker-lines{position:relative;border-left:2px solid rgba(68,65,65,0.84);height:125px;cursor:move}.picker .picker-lines::after{display:block;position:absolute;left:-5px;top:calc(120.5px);background-color:white;width:8px;height:8px;border-radius:4px;content:' '}.picker .picker-lines::before{display:block;position:absolute;content:' ';left:-10px;right:0;width:20px;height:140px}#device-mobile .picker .picker-lines{height:70px}#device-mobile .picker .picker-lines::after{top:calc(65.5px)}#device-mobile .picker .picker-lines::before{display:none}.picker .picker-content{position:absolute;left:2px;top:0;cursor:move;white-space:nowrap;color:white;background-color:rgba(68,65,65,0.84);border-top-right-radius:20px;border-bottom-right-radius:20px}.picker .picker-content .p-title{position:absolute;top:-18px;left:0;color:#fff3e1;text-shadow:0 0 4px black}.picker .picker-content a{color:white}.picker .picker-content span{display:inline-block;padding:0 30px 0 10px}.picker .picker-content span big{display:block;font-size:18px}.picker .picker-content i{font-style:inherit;color:#e4d5bd;font-size:.8em}.picker .picker-content i .iconfont{font-size:10px;margin-left:-0.5em;width:1em;height:1em;display:inline-block;text-align:center;margin-right:.5em;text-shadow:none}.picker .picker-content .picker-link,.picker .picker-content .picker-close-button{transition:.3s opacity 0s;-webkit-transition:.3s opacity 0s;cursor:pointer;display:block;position:absolute}.picker .picker-content .picker-close-button{border:10px solid transparent;background-clip:padding-box;left:calc(100% + 8px);top:-15px}.picker .picker-content .picker-close-button::before{display:block;font-size:18px;width:1em;height:1em;border-radius:1em;border:0;background-color:rgba(68,65,65,0.84)}.picker .picker-content .picker-link{font-size:25px;left:100%;width:1em;height:1em;border-radius:1em;margin-left:-0.7em;bottom:0;background-color:#d49500;box-shadow:0 0 4px 0 black}.picker .picker-content .picker-latlon,.picker .picker-content .picker-share{position:absolute;left:10px;margin-top:10px;top:100%;color:#fff3e1;text-shadow:0 0 4px black;cursor:pointer}.picker .picker-content .picker-share{opacity:0}.picker .picker-content .picker-share::before{position:relative;font-size:1.6em;top:.2em}.picker .picker-content .picker-link:hover+.picker-share,.picker .picker-content .picker-share:hover{opacity:1}.picker .picker-content.p-empty{background:none;width:30px;min-width:30px;height:50px}.picker .picker-content.p-empty .picker-close-button{position:absolute;left:0}.picker .picker-content.p-empty .picker-link{display:none}#device-mobile .picker .picker-content{-webkit-transition:none;transition:none;top:initial;min-height:27px;bottom:100%;border-radius:27px;transform:translateX(-50%);-webkit-transform:translateX(-50%)}#device-mobile .picker .picker-content span,#device-mobile .picker .picker-content .picker-close-button,#device-mobile .picker .picker-content .picker-link{-webkit-transition:none;transition:none}#device-mobile .picker .picker-content span{padding:2px 30px 2px 15px}#device-mobile .picker .picker-content span .p-title{display:none}#device-mobile .picker .picker-content .picker-close-button{top:-10px}#device-mobile .picker .picker-content .picker-close-button::before{font-size:27px}#device-mobile .picker .picker-content.p-empty .picker-close-button{left:-10px;bottom:-10px;top:initial}#device-mobile .picker .picker-content .picker-share{display:none}.picker .picker-drag-me{visibility:visible;transition:visibility 0s linear .5s,opacity .5s linear;position:absolute;bottom:5px;font-size:10px;color:#dedede;left:-5px;white-space:nowrap;transform-origin:left bottom;transform:rotate(-90deg);-webkit-transform-origin:left bottom;-webkit-transform:rotate(-90deg)}.picker .picker-drag-me:before{position:relative;font-size:16px;left:-3px;top:-3px;content:\"'\"}","",function(e){var t=(0,W.require)("rootScope"),i=W.require(t.isMobile?"pickerMobile":"pickerDesktop");this.onopen=function(e){"singleclick"===e.source?i.clickOnMap(e):i.open(e.lat,e.lon,e.noEmit,"bcast")},this.onclose=i.close.bind(i)});