/*! */
riot.tag2("distance",'<div class="dist-first" if="{points.length < 2}">Click on the map to start measurement</div><table if="{distances.length > 0}"><tr><td></td><td>lat</td><td>lon</td><td>bearing</td><td>Nm</td><td></td></tr><tr each="{distances}"><td><div class="dist-ball">{ident}<div></td><td>{point.lat.toFixed(2)}</td><td>{point.lng.toFixed(2)}</td><td><span if="{prop && prop.initialBearing}">{parseInt( prop.initialBearing < 0 ? 360 + prop.initialBearing : prop.initialBearing )}°</span></td><td><span if="{prop && prop.distance}">{( prop.distance / 1000 * 0.5399568 ).toFixed(1)}</span></td><td onclick="{delete.bind(this,index)}"><div class="dist-delete-me" title="delete">t</div></td></tr></table><div class="dist-bottom" if="{distances.length > 0}"><b>{( total / 1000 * 0.5399568 ).toFixed(1)} Nm</b>, {Math.round( total / 1000 ).toFixed(1)} km </div><div if="{points.length > 1}" class="centered mobilehide"><div class="button size-s" onclick="{reset}">Reset</div><div class="button size-s" data-icon="." onclick="{download.bind(this,\'gpx\')}">GPX</div><div class="button size-s" data-icon="." onclick="{download.bind(this,\'kml\')}">KML</div><div class="button size-s" data-do="rqstOpen,share">Share</div></div>',".ondistance #map-container{cursor:crosshair}.ondistance #map-container .labels-layer [data-id],.ondistance #map-container .windy-pois [data-id]{pointer-events:none}#device-mobile .ondistance #rhpane,#device-mobile .ondistance #bottom,#device-mobile .ondistance #plugin-radar,#device-mobile .ondistance #plugin-satellite,#device-mobile .ondistance #mobile-menu{display:none !important}.distance-icon{background-color:#9D0300;border-radius:6px;cursor:move}.distance-icon div{font-size:11px;font-weight:bold;position:relative;top:-2px;left:2px}#plugin-distance{transition:all ease-in-out .5s;-webkit-transition:all ease-in-out .5s;position:absolute;left:8px;width:350px;margin-bottom:70px;opacity:0;background-color:rgba(0,0,0,0.45);text-align:center;font-size:14px;color:white;padding:18px 10px 5px 10px}#plugin-distance.open{opacity:1}#plugin-distance.open .closing-x{display:block}#device-tablet #plugin-distance,#device-desktop #plugin-distance{border-radius:10px}#device-tablet #plugin-distance .closing-x,#device-desktop #plugin-distance .closing-x{font-size:28px;margin-top:-20px;right:-15px}#plugin-distance .dist-delete-me{padding:3px;font-family:iconfont;font-size:11px}#plugin-distance .dist-delete-me:hover{cursor:pointer;background-color:#9D0300}#plugin-distance .centered{margin-top:10px}#plugin-distance table{width:100%}#plugin-distance table td{font-size:12px;padding:6px 3px;border-bottom:1px solid rgba(232,232,232,0.18)}#plugin-distance .dist-ball{width:15px;height:15px;font-size:12px;font-weight:bold;border-radius:7px;background-color:#9D0300}#plugin-distance .dist-first{font-size:14px;margin-bottom:10px}#device-tablet #plugin-distance .dist-first,#device-desktop #plugin-distance .dist-first{font-size:18px;line-height:1.6}#plugin-distance .button{color:white;border-color:white}#plugin-distance .dist-bottom{white-space:nowrap;margin-top:.3em}#device-mobile #plugin-distance .dist-bottom{margin-bottom:12px}#device-tablet #plugin-distance{bottom:50px}#device-mobile #plugin-distance{position:fixed;left:0;right:0;margin-bottom:0;width:inherit;background:#6b6b6b;padding-top:0}#device-mobile #plugin-distance::before{display:block;position:absolute;left:0;right:0;bottom:0;content:' ';background-color:#9D0300;height:40px;z-index:-1}#device-mobile #plugin-distance .closing-x{font-size:35px}#device-mobile #plugin-distance .dist-bottom{font-size:1.4em;position:relative;top:6px;margin-top:0}#device-mobile #plugin-distance .dist-first{position:relative;top:3px}#device-mobile #plugin-distance table tr:last-child td{border-bottom:none}","",function(t){var n=this,i=W.require,e=i("map"),o=i("broadcast"),a=i("utils"),s=i("singleclick"),d=i("location"),l=L.geodesic([],{weight:2,opacity:.8,color:"white",steps:20,wrap:!1}).addTo(e);this.points=[],this.wrappedPoints=[],this.distances=[];var p=1;this.lastPosition=e.getCenter();var r=!1,c=function(){var t=e.getCenter();if(t.lng<0&&n.lastPosition.lng>0||t.lng>0&&n.lastPosition.lng<0){if(t.lng<0)for(var i=0;i<n.points.length;i++)n.points[i]._latlng.lng>90&&(n.points[i]._latlng.lng-=360);else if(t.lng>0)for(var o=0;o<n.points.length;o++)n.points[o]._latlng.lng<-90&&(n.points[o]._latlng.lng+=360);var a=n.points.map(function(t){return t.getLatLng()});l.setLatLngs([a]),n.points.map(function(t){return t.setLatLng([t._latlng.lat,t._latlng.lng])})}n.lastPosition=e.getCenter()};this.onopen=function(t){r||(s.on("distance",u),o.on("mapChanged",c),r=!0),n.reset(),t&&g(t)},this.onclose=function(){n.reset(),r&&(s.off("distance",u),o.off("mapChanged",c),r=!1)};var g=function(t){if(Array.isArray(t)){var n=t[0],i=t[1];m(n.lat,n.lon),m(i.lat,i.lon),e.fitBounds(l.getBounds(),{animate:!0,padding:[20,100]})}else"string"==typeof t&&/\d+/.test(t)?(t.split(";").forEach(function(t){var n=t.split(","),i=n[0],e=n[1];m(i,e)}),e.fitBounds(l.getBounds(),{animate:!0,padding:[20,100]}),setTimeout(f,1e3)):"object"==typeof t&&m(t.lat,t.lon||t.lng||0)},m=function(t,i){var o=p,a=L.divIcon({className:"distance-icon",html:"<div>"+o+"</div>"}),s=L.marker([t,i],{draggable:!0,icon:a}).on("drag",f).addTo(e);s.ident=o,n.points.push(s),f(),p++},u=function(t){var n=t.lat,i=t.lon;return m(n,i)},f=function(){var t=n.points.map(function(t){return t.getLatLng()});if(l.setLatLngs([t]),t.length>1){var i,o,a;for(n.distances=[],n.total=0,i=1;i<n.points.length;i++){o=t[i-1],a=t[i];var s=l._vincenty_inverse(o,a);n.distances.push({index:i,ident:n.points[i-1].ident,point:e.wrapLatLng(o),prop:s}),n.total+=s.distance}n.distances.push({index:i,ident:n.points[i-1].ident,point:e.wrapLatLng(a),prop:{}})}var p=t.map(function(t){var n=t.lat,i=t.lng;return n.toFixed(2)+","+i.toFixed(2)}).join(";");d.url("distance/"+p),n.update()};this.reset=function(){n.points.forEach(function(t){return e.removeLayer(t)}),n.points=[],n.distances=[],p=1,f()},this.delete=function(t){t--,e.removeLayer(n.points[t]),n.points.splice(t,1),n.points.length<=1?n.distances=[]:n.distances.splice(t,1),f()},this.download=function(t){var n="track-"+(new Date).toUTCString().replace(/[:,]/g,"").replace(/ /g,"-")+"."+t,i="gpx"===t?b(n):h(n);a.download(i,"application/gpx+xml",n)};var b=function(t){return'<?xml version="1.0" encoding="utf-8"?>\n\t\t<gpx creator="Windy.com" version="1.1" xmlns="http://www.topografix.com/GPX/1/1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">\n\t\t\t<trk>\n\t\t\t\t<name>Windy.com '+t+"</name>\n\t\t\t\t<trkseg>"+n.distances.map(function(t){var n=t.point,i=t.index;return'<trkpt lat="'+n.lat+'" lon="'+n.lng+'">\n\t\t\t\t\t\t<name>'+i+"</name>\n\t\t\t\t\t</trkpt>"}).join("")+"</trkseg>\n\t\t\t</trk>\n\t\t</gpx>"},h=function(t){return'<?xml version="1.0" encoding="utf-8"?>\n\t\t<kml xmlns="http://www.opengis.net/kml/2.2">\n\t\t<Document>\n\t\t\t<name>Windy.com '+t+'</name>\n\t\t\t<open>1</open>\n\t\t\t<description>\n\t\t\t<![CDATA[\n\t\t\t\tpopisek\n\t\t\t]]>\n\t\t\t</description>\n\t\t\t<Style id="path"><LineStyle><color>b20000ff</color><width>6</width></LineStyle></Style>\n\t\t\t<Style id="routepoint"><IconStyle><color>b20000ff</color><Icon><href>http://maps.google.com/mapfiles/kml/shapes/placemark_square.png</href></Icon></IconStyle></Style>\n\t\t\t<Style id="waypoint"><IconStyle><color>b20000ff</color><Icon><href>http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png</href></Icon></IconStyle></Style>\n\t\t\t<Folder>\n\t\t\t\t<name>1. část</name>\n\t\t\t\t<visibility>1</visibility>\n\t\t\t\t<open>1</open>\n\t\t\t\t<Placemark><name>Windy.com '+t+"</name><styleUrl>#path</styleUrl>\n\t\t\t\t<LineString>\n\t\t\t\t\t<altitudeMode>clampToGround</altitudeMode>\n\t\t\t\t\t<tessellate>1</tessellate>\n\t\t\t\t\t<coordinates>\n"+n.distances.map(function(t){var n=t.point;return n.lng+","+n.lat+",0"}).join("\n")+"\n\t\t\t\t\t</coordinates>\n\t\t\t\t</LineString>\n\t\t\t\t</Placemark>\n\t\t\t</Folder>\n\t\t</Document>\n\t\t</kml>"}});